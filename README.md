# Trading API Gateway

APIç½‘å…³æœåŠ¡ï¼Œä¸ºAIäº¤æ˜“ç³»ç»Ÿæä¾›ç»Ÿä¸€çš„åˆ¸å•†APIå’Œè¡Œæƒ…æ•°æ®ä»£ç†æ¥å£ã€‚

## é¡¹ç›®ç‰¹æ€§

- ğŸš€ åŸºäº Koa + TypeScript æ„å»ºçš„è½»é‡çº§APIç½‘å…³
- ğŸ”Œ æ”¯æŒå¤šä¸ªåˆ¸å•†APIä»£ç†
- ğŸ“Š é›†æˆè¡Œæƒ…æ•°æ®æœåŠ¡
- ğŸ“ å®Œæ•´çš„è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
- âš¡ å¼‚æ­¥/ç­‰å¾…æ¨¡å¼ï¼Œæ€§èƒ½ä¼˜å¼‚
- ğŸ›¡ï¸ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ğŸ”§ ä½¿ç”¨ pnpm è¿›è¡Œä¾èµ–ç®¡ç†

## æŠ€æœ¯æ ˆ

- **Runtime**: Node.js 18+
- **è¯­è¨€**: TypeScript 5+
- **Webæ¡†æ¶**: Koa 2.x
- **HTTPå®¢æˆ·ç«¯**: Axios
- **åŒ…ç®¡ç†å™¨**: pnpm

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- pnpm >= 8.0.0

### å®‰è£…ä¾èµ–

```bash
pnpm install
```

### ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿å¹¶é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å†™å®é™…çš„APIå¯†é’¥å’Œé…ç½®ã€‚

### å¼€å‘æ¨¡å¼

```bash
pnpm dev
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

### ç”Ÿäº§æ„å»º

```bash
# ç¼–è¯‘TypeScript
pnpm build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start
```

## APIç«¯ç‚¹

### å¥åº·æ£€æŸ¥

```
GET /health
```

è¿”å›æœåŠ¡å¥åº·çŠ¶æ€ã€‚

### åˆ¸å•†APIä»£ç†

#### è·å–è´¦æˆ·ä¿¡æ¯

```
GET /broker/:brokerName/account
```

#### ä¸‹å•

```
POST /broker/:brokerName/orders
Content-Type: application/json

{
  "symbol": "AAPL",
  "side": "buy",
  "quantity": 100,
  "type": "market"
}
```

#### æŸ¥è¯¢è®¢å•

```
GET /broker/:brokerName/orders?status=open
```

### è¡Œæƒ…æ•°æ®

#### è·å–æŠ¥ä»·

```
GET /market/quote/:symbol
```

#### è·å–Kçº¿æ•°æ®

```
GET /market/candles/:symbol?interval=1h&limit=100
```

#### è·å–Tickeræ•°æ®

```
GET /market/ticker/:symbol
```

## é¡¹ç›®ç»“æ„

```
trading-api-gateway/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts      # åº”ç”¨å’Œåˆ¸å•†é…ç½®
â”‚   â”œâ”€â”€ middleware/       # Koaä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts   # é”™è¯¯å¤„ç†
â”‚   â”‚   â””â”€â”€ logger.ts          # è¯·æ±‚æ—¥å¿—
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ brokerProxy.ts     # åˆ¸å•†APIä»£ç†
â”‚   â”‚   â””â”€â”€ marketData.ts      # è¡Œæƒ…æ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.ts      # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”œâ”€â”€ health.ts     # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ broker.ts     # åˆ¸å•†APIè·¯ç”±
â”‚   â”‚   â””â”€â”€ market.ts     # è¡Œæƒ…æ•°æ®è·¯ç”±
â”‚   â”œâ”€â”€ types/            # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ logger.ts     # æ—¥å¿—å·¥å…·
â”‚   â”‚   â””â”€â”€ request.ts    # HTTPè¯·æ±‚å·¥å…·
â”‚   â””â”€â”€ app.ts            # åº”ç”¨å…¥å£
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json         # TypeScripté…ç½®
â”œâ”€â”€ nodemon.json          # Nodemoné…ç½®
â”œâ”€â”€ .eslintrc.js          # ESLinté…ç½®
â”œâ”€â”€ .prettierrc           # Prettieré…ç½®
â””â”€â”€ README.md
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„åˆ¸å•†

1. åœ¨ `src/config/index.ts` çš„ `brokerConfigs` ä¸­æ·»åŠ æ–°çš„åˆ¸å•†é…ç½®
2. æ ¹æ®éœ€è¦æ‰©å±• `BrokerProxyService` çš„æ–¹æ³•
3. æ›´æ–° `.env.example` æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡

### ä»£ç è§„èŒƒ

```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
pnpm lint

# æ ¼å¼åŒ–ä»£ç 
pnpm format
```

## æ—¥å¿—

åº”ç”¨ä½¿ç”¨ Winston è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œæ—¥å¿—çº§åˆ«å¯é€šè¿‡ç¯å¢ƒå˜é‡ `LOG_LEVEL` é…ç½®ã€‚

æ”¯æŒçš„æ—¥å¿—çº§åˆ«ï¼š
- `error` - ä»…é”™è¯¯
- `warn` - è­¦å‘Šå’Œé”™è¯¯
- `info` - ä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ï¼ˆé»˜è®¤ï¼‰
- `debug` - è°ƒè¯•åŠä»¥ä¸Šæ‰€æœ‰çº§åˆ«

## å®‰å…¨æ€§

- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ï¼ˆAPIå¯†é’¥ã€å¯†é’¥ï¼‰åº”å­˜å‚¨åœ¨ `.env` æ–‡ä»¶ä¸­ï¼Œåˆ‡å‹¿æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- å»ºè®®æ·»åŠ è¯·æ±‚é™æµä¸­é—´ä»¶é˜²æ­¢APIæ»¥ç”¨

## License

MIT
